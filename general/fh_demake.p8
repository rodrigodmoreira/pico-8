pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- init
function _init()
	players={}
	players[0]=player:new(35,71,0)
	players[1]=player:new(75,38,1)
end

-->8
-- update
function _update()
	handle_input(0)
	handle_input(1)
end

function handle_input(p)
	p=p or 0
	if (btnp(0,p)) players[p].stance=0
	if (btnp(1,p)) players[p].stance=1
	if (btnp(2,p)) players[p].stance=2
	if (btnp(4,p)) print("atk"..p)
	if (btnp(5,p)) print("gb"..p)
end

-->8
-- draw
function _draw()
	cls()
	rect(30,30, 97,97, 13)
	draw_player_0()
	draw_player_1()
	draw_hud()
end

function draw_player_0()
	local p=players[0]
	
	if p.stance==0 then
		spr(2, p.pos.x-6, p.pos.y-4, 2,3, true)
	end
	
	spr(0, p.pos.x, p.pos.y, 2,3)
	
	if p.stance==1 then
		spr(2, p.pos.x+7, p.pos.y-4, 2,3)
	elseif p.stance==2 then
		spr(4, p.pos.x+8, p.pos.y+2, 2,2)
	end
end

function draw_player_1()
	local p=players[1]
	local x=p.pos.x
	local y=p.pos.y
	
	spr(14, x, y, 2,3)

	if p.stance==0 then
		spr(6, x-2, y-5, 2,3)
	elseif p.stance==1 then
		spr(8, x+3, y-4, 2,3)
	elseif p.stance==2 then
		spr(42, x-13, y+4, 4,2)
	end
end

function draw_hud()
	draw_stats(19,87, "p1", players[0].hp, players[0].st)	
	draw_stats(102,30, "p2", players[1].hp, players[1].st)
end

function draw_stats(x,y, txt, hp, st)
	print(txt, x,y, 13)
	print(hp, x-2,y+6, 13)
end

-->8
-- utils
vec2={
	new=function(self, x,y)
		return {x=x or 0, y=y or 0}
	end
}

player={
	new=function(self, x,y,st)
		return {
			pos=vec2:new(x,y),
			stance=st or 0,
			hp=100,
			state=self:nstate(),
			action_queue={}
		}
	end,
	nstate=function()
		return {
			name="idle",
			start=time()
		}
	end
}

__gfx__
00000000000000000000000000a00000000000000000000000000000000000000000000000000a00000aa9900000000000000000000000000000000000000000
0000000000000000000000000a90000000000000000000000090000000000000000000000000a90000000aa99000000000000000000000000000000000000000
0000000000000000000000000a900000000000000000000000a9000000000000000000000000a9000000000aa990000000000000000000000000000000000000
0000000066666000000000000a900000000000000000000000a9000000000000000000000000a900000000000aa9900000000000000000000000066666000000
0000000666666600000000000a900000000000000000000000a9000000000000000000000000a90000000000000aa99800000000000000000000666666600000
0000000666666600000000000a900000000000000000000000a9000000000000000000000000a9000000000000000aa980000000000000000000666666600000
0000000666666600000000000a900000000000009000000000a9000000000000000000000000a900000000000000008a8e000000000000000000666666600000
0000000666666600000000000a90000000000000a900000000a9000000000000000000000000a9000000000000000008ee000000000000000000666666600000
0000000000066600000000000a90000000000000a880000000a9000000000000000000000000a9000000000000000000dee00000000000000000666666600000
0000000555006000000000000a900000000066008888000000a9000000000000000000000000a9000000000000000000deee0000000000000000666666000000
0000055555550000000000000a900000000666668eee000000a9000000000000000000000000a900000000000000dd0d666ee000000000000000066665500000
0000555555555000000000000a90000000066666666ee00000a9000000000000000000000000a90000000dd0000d6666666e0000000000000000555555550000
0000555555555500000000000a900000000666666666e00000a9000000000000000000000000a9000000d0000006666666600000000000000000555555555000
0000555555555500000000000a900000000066666666e00000a9000000000000000000000000a90000000000000666666d000000000000000000555555555000
0005555555555500000000000a90000000000dddd000000000a9000000000000000000005000a9000000000000066666dd000000000000000000555555555000
000555555555550000000660888800000000ddd00000000000a9000000000660066000000508888000000000000066ddd0000000000000000000055555555500
0005555555555000000066660ee00000000000000000000008888000000066666666000000d06660000000000000000000000000000000000000055555555500
00055555555500000000666666ee0000000000000000000006660d00000666666666600000dd6660000000000000000000000000000000000000005555555500
0005555555550000000066666666000000000000000000000666dd00006666666666660000ddeee0000000000000000000000000000000000000005555555500
0005555555500000000006666666000000000000000000000eeedd000666666dd666666000deeee6000000000000000000000000000000000000005555555500
0005555555500000000000dd666e000000000000000000006eeeeeee66666d0005d66666eeeeeee6000000000000000000000000000000000000005555555500
000555555550000000000dddd000000000000000000000006eeeeee666660000005066666eeee666000000000000000000000000000000000000005555555500
000555555550000000000ddd000000000000000000000000666eeee666600000000006666eeed66d000000000000066600000006660000000000005555555500
000055555550000000000ddd000000000000000000000000d66deeee6d000000000000d6eee0000000000000000066666d000066666000000000000555555000
0000000000000000000000000000000000000000000000000aa900000000000000000000000000000000000000088e66d0000666666000000000000000000000
00000000000000000000000000000000000000000000000aa99000000000000000000000000000000000000000aa98eeee06666666d000000000000000000000
000000000000000000000000000000000000000000000aa99000000000000000000000009000000000000000aa9998eee66666666d5000000000000000000000
0000000000000000000000000000000000000000000aa990000000000000000000000009a0000000000000aa999880eee66666d0000000000000000000000000
00000000000000000000000000000000000000000dd99000000000000000000000000009a00000000000aa9990000000e66d0000000000000000000000000000
000000900000000000000000000000000000000aadddd000000000000000000000000009a000000000aa99900000000000000000000000000000000000000000
000000a900000000000000000000000000000aad9dddd000000000000000000000000009a0000000aa9990000000000000000000000000000000000000000000
000000a900000000000000000000000000000990ddedd000000000000000000000000009a0000000999000000000000000000000000000000000000000000000
000000a9000000000000000000000000000090000eee0000000000000000000000000009a0000000000000000000000000000000000000000000000000000000
000000a90000000000000000000d0000000000000ee000000000000000dd000000000009a0000000000000000000000000000000000000000000000000000000
000000a9000000000000000000d0000000666000eee0000000000000dddd000000000009a0000000aaa000000000000000000000000000000000000000000000
000000a000000000000000000dd000000666660eeee0000000000000dddd0d0000000009a0000000099aa0000000000000000000000000000000000000000000
000000a00000000000dd0000ddd000000666666deee0000000000000ddddd00000000009a000000000099aa00000000000000000000000000000000000000000
000000a00000000000dddd00dd0000000d6666666e000000000000000ddd000000000009a0000000000dd99aa000000000000000000000000000000000000000
000000a000000000d0dddd00dd000000000d6666600000000000000000ee000000000009a0000000000dddd99aa0000000000000000000000000000000000000
000000a0000000000ddedd000d00000000000000000000000000000000eee00006000009a6600000000ddddd099aa00000000000000000000000000000000000
000000a00000000000eee0000000000000000000000000000000000000eeee0066000009a66600000000ddd000099aa000000000000000000000000000000000
0000d0000000000000ee000000000000000000000000000000000000000eeee666000009a666000000000ee00000099a8d006600000000000000000000000000
000d0000000666000eee000000000000000000000000000000000000000eeee666000009a666600000000eee000060098dd56660000000000000000000000000
00dd000000666660eeee0000000000000000000000000000000000000000ee6660000009a066600000000eeee0066008dddde666000000000000000000000000
0ddd000000666666deee000000000000000000000000000000000000000006660000008888066e00000000eeee6660000ddeeeee600000000000000000000000
0dd0000000d6666666e0000000000000000000000000000000000000000000000000000eee0eeee0000000eeee666000000eeeeee00000000000000000000000
0dd000000000d6666600000000000000000000000000000000000000000000000000000eeeeeeee00000000ee666000000000eeee00000000000000000000000
00d00000000000000000000000000000000000000000000000000000000000000000000eeeeeee000000000066600000000000ee000000000000000000000000
