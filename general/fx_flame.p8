pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- init

function _init()
	entities = {}
	consts={
		max=100,
		spread_x=10,
		spread_y=10,
		initial_size=5,
		color_range={
			yellow=4.7,
			orange=4.4,
			red=3.6
		},
		speed_y=2
	}
	utils()
	
	ct=0

	f = flame:new(67, 79)
	add(entities, f)
end

-->8
-- update

function _update60()
	update_entities()
end

function update_entities()
	for entity in all(entities)	do
		local tab = getmetatable(entity)
		if getmetatable(flame)==table then			
			-- update flame pos
			if (btn(0)) entity.pos.x=entity.pos.x-1
			if (btn(1)) entity.pos.x=entity.pos.x+1
			if (btn(2)) entity.pos.y=entity.pos.y-1
			if (btn(3)) entity.pos.y=entity.pos.y+1

			-- guanratee sparks
			while #entity.children<consts.max do
				add(entity.children,
					flame:create_child(
						entity.pos.x-consts.spread_x/2+rnd(consts.spread_x),
						entity.pos.y-consts.spread_y/2+rnd(consts.spread_y)
					)
				)
			end
			
			-- update sizes
			for spark in all(entity.children) do
				spark.pos.x=spark.pos.x+1*(1-2*rnd(1))*sin(time())
				spark.pos.y=spark.pos.y-consts.speed_y
				spark.size=spark.size-rnd(10)/(3*10)
				
				if (spark.size<=0) del(entity.children, spark)  
				print()
			end
		end
	end
	
	ct=ct+1
end
-->8
-- draw

function _draw()
	cls(0)
	draw_boundaries()
	draw_entities()
	print(#entities[1].children, 2,2, 8)
end

function draw_entities()
	for entity in all(entities)	do
		local tb_name = getmetatable(entity)
		if (flame==tb_name) draw_flame(entity)
	end
end

function draw_flame(entity)
	for child in all(entity.children) do
		circfill(child.pos.x, child.pos.y, child.size, get_flame_color(child.size))
	end
end

function get_flame_color(size)
	if size>=consts.color_range.yellow then return 10
	elseif size>=consts.color_range.orange then return 9
	elseif size>=consts.color_range.red then return 8
	else return 5 end
end

function draw_boundaries()
	local bcolor=8
	line(0,0, 127,0, bcolor)
	line(127,0, 127,127, bcolor)
	line(127,127, 0,127, bcolor)
	line(0,127, 0,0, bcolor)
end

-->8
-- utils
function utils()
	vec2={} 
	vec2.new=function (self, x,y)
		local obj = {x=x,y=y}
		setmetatable(obj, vec2)
		return obj
	end
	
	print_tb=function (tb)
		print('tb_print ----')
		for k,v in pairs(tb) do
			print('- '..k)
			print(v)
		end
		print('----')
	end

	-- entities

	flame={
		new=function (self,x,y)
			local obj = {
				ttl=5*60,
				pos=vec2:new(x,y),
				children={}
			}
			setmetatable(obj, self)

			return obj
		end
	}
	flame.create_child=function (self,x,y)
		return {
			size=consts.initial_size,
			pos=vec2:new(x,y)
		}
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80888088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80888088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80008080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80008088800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000550000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000555000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000500550000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000005550005000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000505000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000050000050000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000500000005500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000005000055550000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000505500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000500000000500000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555000055550000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555500555505000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000005000050555500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000005555000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000050500000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000055500555550555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555550055555555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555550555505555550000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555555555555555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555555555505555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555555555500000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555555555500555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555555555005555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555555550005555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000055555555555055555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000055555555555555555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000055555555555555550000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000005555555555555550000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555555555555500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000088855555555555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000888555555555555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000008885555555555555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000008885555555555555500000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000008885555555555555000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000888555555555500000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000085555588555000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000055555888880000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000555555588888000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000588855888888800000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000008888888888888850000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000008888888888888885000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000088888888888888885000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000088888888888888888000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000088888888888888888000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000888aaa89999888888000000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000aaaaaaa999998888000000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000aaaaaaa999998888000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000aaaaaaaaa9999aa98000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000aaaaaaaaa9999aaaa000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000aaaaaaaaa999999aa000000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000aaaaaaa999999999a00000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000aaaaaaa999999999a00000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000aaaaaaa999999999900000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000009aaaaaaaaa9999999900000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000099aaaaaaaa9999999900000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000099aaaaaaaaa999999000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000009aaaaaaaaa999999000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000009aaaaaaaaaa99900000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000000aaaaaaaaa00000000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000000aaaaaaaa000000000000000000000000000000000000000000000000000000000000008
8000000000000000000000000000000000000000000000000000000000aaaaaaa000000000000000000000000000000000000000000000000000000000000008
800000000000000000000000000000000000000000000000000000000000aaa00000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

__sfx__
000100000161005600016100160001610016000161001610016100161001610016100161013610016100161019610016100160001610016100161001610016000161001610016100d61001610016000461001610
000100000c6000c6000c6000060000600006000060000600006000060000600006000060000600326103a62000600006000060000600006000060000600006000060000600006000060000600006000060000600
__music__
00 01424344

